<dom-module id="uql-sidebar" class="layout vertical">
  <link rel="import" href="../bower_components/polymer/polymer.html">
  <link rel="import" href="../bower_components/neon-animation/animations/slide-from-left-animation.html">
  <link rel="import" href="../bower_components/neon-animation/animations/slide-left-animation.html">
  <link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html">
  <link rel="import" href="theme/theme.html">
  <link rel="stylesheet" type="text/css" href="../styles/elements-styles.css">
  <link rel="stylesheet" type="text/css" href="theme/theme.css">

  <style is="custom-style">
    :host {
      display: block;
    }

    #main {
      width: 269px;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background-color: #eee;
      z-index: 1;
    }

    paper-menu.sublist paper-item a {
      padding-left: 1em;
    }
  </style>

  <template is="dom-bind">
    <iron-ajax auto url="{{menuJson}}" handle-as="json" on-response="_handleResponse" verbose="{{debug}}"></iron-ajax>
    <paper-material elevation="1" id="main" hidden="{{hideMenu}}" class="layout vertical">
      <paper-toolbar class="toggle">
        <div class="title">{{menu.heading}}</div>
      </paper-toolbar>
      <paper-menu id="main-menu" attr-for-selected="data-route" selected="[[route]]" class="flex">
        <template is="dom-repeat" items="{{menu.items}}">
          <!-- load up single menu items without submenus -->
          <template is="dom-if" if="{{!item.items}}">
            <paper-item>
              <template is="dom-if" if="{{item.icon}}">
                <iron-icon icon="{{item.icon}}"></iron-icon>
              </template>
              <template is="dom-if" if="{{item.href}}">
                <a href="{{item.href}}" on-click="onDataRouteClick">
              </template>
              <span>{{item.label}}</span>
              <template is="dom-if" if="{{item.href}}">
                </a>
              </template>
            </paper-item>
          </template>

          <!-- load up menu items with submenus -->
          <template is="dom-if" if="{{item.items}}">
            <paper-submenu>
              <paper-item class="menu-trigger">
                <template is="dom-if" if="{{item.icon}}">
                  <iron-icon icon="{{item.icon}}"></iron-icon>
                </template>
                <template is="dom-if" if="{{item.href}}">
                  <a href="{{item.href}}">
                </template>
                <span>{{item.label}}</span>
                <iron-icon icon="arrow-drop-down"></iron-icon>
                <template is="dom-if" if="{{item.href}}">
                  </a>
                </template>
              </paper-item>
              <paper-menu class="menu-content sublist">
                <template is="dom-repeat" items="{{item.items}}" as="subitem">
                  <paper-item>
                    <template is="dom-if" if="{{subitem.icon}}">
                      <iron-icon icon="{{subitem.icon}}"></iron-icon>
                    </template>
                    <template is="dom-if" if="{{subitem.href}}">
                      <a href="{{subitem.href}}">
                    </template>
                    <span>{{subitem.label}}</span>
                    <template is="dom-if" if="{{subitem.href}}">
                      </a>
                    </template>
                  </paper-item>
                </template>
              </paper-menu>
            </paper-submenu>
          </template>
        </template>
      </paper-menu>
      <paper-button class="toggle colorful" raised>
        <iron-icon icon="backspace"></iron-icon>
        Close
      </paper-button>
    </paper-material>
  </template>

  <script>
    (function () {
      Polymer({
        is: 'uql-sidebar',
        debug: 'true',
        menu: {},
        hideMenu: 0,
        behaviors: [Polymer.NeonAnimationRunnerBehavior],
        properties: {
          visible: {
            type: String,
            observer: '_computeVisibility'
          },
          menuJson: {
            type: String
          },
          animationConfig: {
            value: function () {
              return {
                'entry': {
                  name: 'slide-from-left-animation',
                  node: this.$.main
                },
                'exit': {
                  name: 'slide-left-animation',
                  node: this.$.main
                }
              };
            }
          }
        },
        listeners: {
          'neon-animation-finish': '_onNeonAnimationFinish'
        },
        _handleResponse: function () {
          this.menu = event.detail.response;
        },
        _onNeonAnimationFinish: function () {
          this.hideMenu = this.visible === 'true' ? 0 : 1;
        },
        _computeVisibility: function () {
          if (this.visible === 'true') {
            this.hideMenu = 0;
          }
          this.playAnimation(this.visible === 'true' ? 'entry' : 'exit');
        }
      });
    })();
  </script>

</dom-module>
